{{ define "main" }}

  <section>
    <article class="home__detail">
      <h1>Willkommen bei fini-kreativ!</h1>
      <span>Aus Stoffen von gestern – Taschen für morgen.</span>

      <div class="slider" data-slider>
        {{ with resources.Match "products/*" }}
        <div class="slides" data-slides>
            {{ range $index, $img := . }}
            {{ $small := $img.Resize "400x" }}
            {{ $large := $img.Resize "800x" }}

            <div class="slide">
              <img 
                class="home__image" 
                src="{{ $small.RelPermalink }}"
                srcset="{{ $small.RelPermalink }} 1x, {{ $large.RelPermalink }} 2x"
                alt="{{ $.Title }}">
            </div>
          {{ end }}
        </div>

        <div class="dots" data-dots>
          {{ range $index, $img := . }}
            <button data-dot="{{ $index }}" aria-label="{{ add $index 1 }}"></button>
          {{ end }}
        </div>
        {{ end }}
      </div>
    </article>
  </section>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const slider = document.querySelector("[data-slider]");
    if (!slider) return;

    const slides = slider.querySelector("[data-slides]");
    const dots = slider.querySelectorAll("[data-dots] button");
    const total = dots.length;
    let index = 0;
    let startX = 0;

    function goToSlide(i) {
      index = (i + total) % total;
      slides.style.transform = `translateX(-${index * 100}%)`;
      dots.forEach((dot, idx) => dot.classList.toggle("active", idx === index));
    }

    dots.forEach((dot, i) => dot.addEventListener("click", () => {
      goToSlide(i);
      resetAutoSlide();
    }));

    slides.addEventListener("touchstart", e => startX = e.touches[0].clientX);
    slides.addEventListener("touchend", e => {
      const diff = e.changedTouches[0].clientX - startX;
      if (Math.abs(diff) > 50) {
        goToSlide(index + (diff < 0 ? 1 : -1));
        resetAutoSlide();
      }
    });

    goToSlide(0);

    // Automatischer Slide alle 5 Sekunden
    let autoSlideInterval = setInterval(() => goToSlide(index + 1), 5000);

    function resetAutoSlide() {
      clearInterval(autoSlideInterval);
      autoSlideInterval = setInterval(() => goToSlide(index + 1), 5000);
    }
  });
  </script>
{{ end }}
